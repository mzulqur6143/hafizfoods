<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hafiz Chicken Tikka Biryani</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
        }

        header {
            background-color: #327646;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            margin-right: 15px;
            background: white;
            border-radius: 50%;
        }

        nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .nav-btn.active {
            background: white;
            color: #327646;
        }

        .section {
            display: none;
            padding: 1rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .btn {
            background: #327646;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            font-size: 0.9em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 0.75rem;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
        }

        .bill-summary {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .item-card {
            background: white;
            padding: 1rem;
            margin: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #ddd;
            display: inline-block;
            width: calc(33% - 1rem);
        }

        .pending-bill-card {
            background: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .settings-section {
            background: white;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .menu-item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .action-btns button {
            margin: 0 0.25rem;
            padding: 0.25rem 0.5rem;
        }

        .customer-optional {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }

        .password-prompt {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            margin: 2rem auto;
            max-width: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .password-prompt h3 {
            margin-bottom: 1rem;
            color: #327646;
        }

        .password-prompt input {
            margin-bottom: 1rem;
        }

        .category-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .categories-list {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #ddd;
        }

        @media (max-width: 768px) {
            .item-card {
                width: calc(50% - 1rem);
            }
            .category-management {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .item-card {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo"></div>
            <h1 id="restaurant-name">Hafiz Chicken Tikka Biryani</h1>
        </div>
        <nav>
            <button class="nav-btn active" onclick="showSection('billing')">Billing</button>
            <button class="nav-btn" onclick="showSection('pending')">Pending Bills</button>
            <button class="nav-btn" onclick="showSection('search')">Search Bill</button>
            <button class="nav-btn" onclick="showSection('reports')">Reports</button>
            <button class="nav-btn" onclick="showSection('settings')">Settings</button>
        </nav>
    </header>

    <main>
        <!-- Billing Section -->
        <section id="billing" class="section active">
            <h2>New Bill #<span id="bill-number">1</span></h2>
            <p id="current-date">3 April 2025, 11:00 AM</p>
            
            <div class="form-group">
                <label>Customer Name <span class="customer-optional">(Optional - Walk-in Customer for empty)</span></label>
                <input type="text" id="customer-name" placeholder="Enter name or leave blank for Walk-in Customer">
            </div>
            
            <div class="form-group">
                <label>Phone Number <span class="customer-optional">(Optional)</span></label>
                <input type="text" id="customer-phone" placeholder="Enter phone number">
            </div>

            <div class="form-group">
                <label>Order Type</label>
                <select id="order-type">
                    <option value="dine-in">Dine In</option>
                    <option value="take-away">Take Away</option>
                    <option value="delivery">Delivery</option>
                    <option value="food-panda">Food Panda</option>
                </select>
            </div>

            <h3>Add Items</h3>
            <div class="form-group">
                <select id="category-filter" onchange="filterMenuItems()">
                    <option value="">All Categories</option>
                </select>
            </div>
            <div id="menu-items">
                <!-- Menu items will appear here -->
            </div>

            <h3>Current Order</h3>
            <table id="order-items">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Price</th>
                        <th>Qty</th>
                        <th>Unit</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="order-items-body">
                    <!-- Order items will appear here -->
                </tbody>
            </table>

            <div class="bill-summary">
                <div class="form-group">
                    <label>Delivery Charges</label>
                    <input type="number" id="delivery-charges" value="0" min="0" onchange="calculateTotal()">
                </div>
                <div class="form-group">
                    <label>Discount (%)</label>
                    <input type="number" id="discount-percent" value="0" min="0" max="100" onchange="calculateTotal()">
                </div>
                <div class="form-group">
                    <label>Tax (%)</label>
                    <input type="number" id="tax-percent" value="0" min="0" max="100" onchange="calculateTotal()">
                </div>
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">Rs. 0.00</span>
                </div>
                <div class="summary-row">
                    <span>Discount:</span>
                    <span id="discount-amount">Rs. 0.00</span>
                </div>
                <div class="summary-row">
                    <span>Tax:</span>
                    <span id="tax-amount">Rs. 0.00</span>
                </div>
                <div class="summary-row">
                    <span>Delivery:</span>
                    <span id="delivery-display">Rs. 0.00</span>
                </div>
                <div class="summary-row">
                    <span>Total:</span>
                    <span id="total-amount" style="font-weight: bold; font-size: 1.2em;">Rs. 0.00</span>
                </div>
            </div>

            <div class="form-group">
                <label>Payment Method</label>
                <select id="payment-method">
                    <option value="cash">Cash</option>
                    <option value="jazzcash">JazzCash</option>
                    <option value="easypaisa">Easypaisa</option>
                    <option value="foodpanda">Food Panda</option>
                </select>
            </div>

            <button class="btn" onclick="saveBill()">Save Bill</button>
            <button class="btn" onclick="saveBillAndPrint()">Save & Print</button>
            <button class="btn" onclick="saveBillAndWhatsApp()">Save & WhatsApp</button>
            <button class="btn" onclick="savePending()">Save as Pending</button>
        </section>

        <!-- Other Sections -->
        <section id="pending" class="section">
            <h2>Pending Bills</h2>
            <div id="pending-bills">
                <!-- Pending bills will appear here -->
            </div>
        </section>

        <section id="search" class="section">
            <h2>Search Bills</h2>
            <div class="form-group">
                <input type="number" id="search-bill-no" placeholder="Enter bill number">
                <button class="btn" onclick="searchBill()">Search by Bill No</button>
            </div>
            <div class="form-group">
                <input type="date" id="search-date">
                <button class="btn" onclick="searchByDate()">Search by Date</button>
            </div>
            <div id="search-results"></div>
        </section>

        <!-- Reports Section with Password -->
        <section id="reports" class="section">
            <div class="password-prompt" id="reports-password-prompt">
                <h3>Enter Password for Reports</h3>
                <input type="password" id="reports-password" placeholder="Enter password">
                <button class="btn" onclick="loginToReports()">Login</button>
            </div>
            <div id="reports-content" style="display: none;">
                <h2>Daily Reports</h2>
                <div class="form-group">
                    <button class="btn" onclick="showDailyReports()">Daily</button>
                    <button class="btn" onclick="showWeeklyReports()">Weekly</button>
                    <button class="btn" onclick="showMonthlyReports()">Monthly</button>
                </div>
                <div id="reports-data">
                    <!-- Reports data will appear here -->
                </div>
            </div>
        </section>

        <!-- Settings Section with Password -->
        <section id="settings" class="section">
            <div class="password-prompt" id="settings-password-prompt">
                <h3>Enter Password for Settings</h3>
                <input type="password" id="settings-password" placeholder="Enter password">
                <button class="btn" onclick="loginToSettings()">Login</button>
            </div>
            <div id="settings-content" style="display: none;">
                <h2>Settings</h2>
                
                <!-- Restaurant Information -->
                <div class="settings-section">
                    <h3>Restaurant Information</h3>
                    <div class="form-group">
                        <label>Restaurant Name</label>
                        <input type="text" id="restaurant-name-input" value="Hafiz Chicken Tikka Biryani">
                        <button class="btn" onclick="updateRestaurantName()">Update Name</button>
                    </div>
                </div>

                <!-- Category Management -->
                <div class="settings-section">
                    <h3>Category Management</h3>
                    <div class="category-management">
                        <div>
                            <h4>Add New Category</h4>
                            <input type="text" id="new-category" placeholder="Enter category name">
                            <button class="btn" onclick="addNewCategory()">Add Category</button>
                        </div>
                        <div class="categories-list">
                            <h4>Current Categories</h4>
                            <div id="categories-list">
                                <!-- Categories will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu Management -->
                <div class="settings-section">
                    <h3>Menu Management</h3>
                    
                    <div class="form-group">
                        <h4>Add New Item</h4>
                        <input type="text" id="new-item-name" placeholder="Item Name">
                        <input type="number" id="new-item-price" placeholder="Price">
                        <select id="new-item-category">
                            <option value="">Select Category</option>
                        </select>
                        <select id="new-item-unit">
                            <option value="plate">Plate</option>
                            <option value="kg">Kg</option>
                            <option value="bowl">Bowl</option>
                            <option value="bottle">Bottle</option>
                            <option value="custom">Custom Unit</option>
                        </select>
                        <input type="text" id="custom-unit-input" placeholder="Enter custom unit" style="display: none;">
                        <button class="btn" onclick="addNewMenuItem()">Add Item</button>
                    </div>

                    <div class="form-group">
                        <h4>Current Menu Items</h4>
                        <div id="menu-items-list">
                            <!-- Menu items will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- Bill Settings -->
                <div class="settings-section">
                    <h3>Bill Settings</h3>
                    <div class="form-group">
                        <label>Bill Number Reset Frequency</label>
                        <select id="reset-frequency">
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="manual">Manual Only</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Current Bill Number: <span id="current-bill-no">1</span></label>
                        <button class="btn" onclick="resetBillNumber()">Reset Bill Number to 1</button>
                    </div>
                </div>

                <!-- Custom Units -->
                <div class="settings-section">
                    <h3>Custom Units</h3>
                    <div class="form-group">
                        <input type="text" id="new-custom-unit" placeholder="New unit name">
                        <button class="btn" onclick="addCustomUnit()">Add Unit</button>
                    </div>
                    <div id="custom-units-list">
                        <!-- Custom units will be listed here -->
                    </div>
                </div>

                <!-- Password Settings -->
                <div class="settings-section">
                    <h3>Password Settings</h3>
                    <div class="form-group">
                        <input type="password" id="new-password" placeholder="New Password">
                        <input type="password" id="confirm-password" placeholder="Confirm Password">
                        <button class="btn" onclick="changePassword()">Change Password</button>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="settings-section">
                    <h3>Data Management</h3>
                    <button class="btn" onclick="exportData()">Export Data</button>
                    <button class="btn" onclick="importData()">Import Data</button>
                    <input type="file" id="import-file" style="display: none;" onchange="handleFileImport(this.files)">
                    <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Simple data storage with FIXED password
        let restaurantData = {
            bills: [],
            menuItems: [
                {id: 1, name: "Chicken Biryani", price: 300, category: "Biryani", unit: "plate"},
                {id: 2, name: "Beef Biryani", price: 350, category: "Biryani", unit: "plate"},
                {id: 3, name: "Chicken Karahi", price: 1200, category: "Karahi", unit: "kg"},
                {id: 4, name: "Beef Karahi", price: 1500, category: "Karahi", unit: "kg"},
                {id: 5, name: "Cold Drink", price: 60, category: "Beverages", unit: "bottle"},
                {id: 6, name: "Mineral Water", price: 40, category: "Beverages", unit: "bottle"}
            ],
            expenses: [],
            settings: {
                restaurantName: "Hafiz Chicken Tikka Biryani",
                password: "zulqur",
                billNumber: 1,
                resetFrequency: "weekly",
                customUnits: ["plate", "kg", "bowl", "bottle", "piece", "pack"],
                categories: ["Biryani", "Karahi", "Beverages", "Rice", "BBQ", "Desserts"]
            },
            currentBill: {
                number: 1,
                items: [],
                customer: {name: "", phone: ""},
                orderType: "dine-in",
                paymentMethod: "cash"
            }
        };

        // Track login status
        let isReportsLoggedIn = false;
        let isSettingsLoggedIn = false;

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('restaurantData');
            
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Merge data properly
                    restaurantData.bills = parsed.bills || [];
                    restaurantData.menuItems = parsed.menuItems || restaurantData.menuItems;
                    restaurantData.expenses = parsed.expenses || [];
                    restaurantData.settings = {
                        ...restaurantData.settings,
                        ...parsed.settings
                    };
                    restaurantData.currentBill = parsed.currentBill || restaurantData.currentBill;
                } catch (error) {
                    console.error("Error parsing saved data:", error);
                }
            }
            
            // Ensure current bill number is correct
            restaurantData.currentBill.number = restaurantData.settings.billNumber;
            updateDisplay();
            updateCategorySelects();
            loadCategoriesList();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('restaurantData', JSON.stringify(restaurantData));
        }

        // Update UI
        function updateDisplay() {
            // Update bill number and date
            document.getElementById('bill-number').textContent = restaurantData.currentBill.number;
            document.getElementById('current-date').textContent = new Date().toLocaleString();
            
            // Update categories filter
            updateCategoriesFilter();
            
            // Update menu items
            filterMenuItems();
            
            // Update order items
            updateOrderDisplay();
        }

        function updateCategoriesFilter() {
            const categoryFilter = document.getElementById('category-filter');
            const categories = [...new Set(restaurantData.menuItems.map(item => item.category))];
            
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        function updateCategorySelects() {
            const categorySelect = document.getElementById('new-item-category');
            const categories = restaurantData.settings.categories || [];
            
            categorySelect.innerHTML = '<option value="">Select Category</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        function filterMenuItems() {
            const selectedCategory = document.getElementById('category-filter').value;
            const menuDiv = document.getElementById('menu-items');
            menuDiv.innerHTML = '';
            
            let itemsToShow = restaurantData.menuItems;
            if (selectedCategory) {
                itemsToShow = restaurantData.menuItems.filter(item => item.category === selectedCategory);
            }
            
            itemsToShow.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                itemCard.innerHTML = `
                    <strong>${item.name}</strong><br>
                    Rs. ${item.price} / ${item.unit}<br>
                    <small>${item.category}</small>
                `;
                itemCard.onclick = () => addToBill(item);
                menuDiv.appendChild(itemCard);
            });
        }

        function updateOrderDisplay() {
            const orderBody = document.getElementById('order-items-body');
            orderBody.innerHTML = '';
            
            restaurantData.currentBill.items.forEach((item, index) => {
                const total = item.price * item.quantity;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>Rs. ${item.price}</td>
                    <td>
                        <button onclick="changeQuantity(${index}, -1)">-</button>
                        ${item.quantity}
                        <button onclick="changeQuantity(${index}, 1)">+</button>
                    </td>
                    <td>${item.unit}</td>
                    <td>Rs. ${total}</td>
                    <td><button class="btn-danger" onclick="removeItem(${index})">Remove</button></td>
                `;
                orderBody.appendChild(row);
            });

            calculateTotal();
        }

        function calculateTotal() {
            const subtotal = restaurantData.currentBill.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryCharges = parseFloat(document.getElementById('delivery-charges').value) || 0;
            const discountPercent = parseFloat(document.getElementById('discount-percent').value) || 0;
            const taxPercent = parseFloat(document.getElementById('tax-percent').value) || 0;
            
            const discountAmount = subtotal * (discountPercent / 100);
            const taxAmount = (subtotal - discountAmount) * (taxPercent / 100);
            const total = subtotal - discountAmount + taxAmount + deliveryCharges;
            
            document.getElementById('subtotal').textContent = `Rs. ${subtotal.toFixed(2)}`;
            document.getElementById('discount-amount').textContent = `Rs. ${discountAmount.toFixed(2)}`;
            document.getElementById('tax-amount').textContent = `Rs. ${taxAmount.toFixed(2)}`;
            document.getElementById('delivery-display').textContent = `Rs. ${deliveryCharges.toFixed(2)}`;
            document.getElementById('total-amount').textContent = `Rs. ${total.toFixed(2)}`;
        }

        // Category Management Functions
        function addNewCategory() {
            const newCategory = document.getElementById('new-category').value.trim();
            if (!newCategory) {
                alert('Please enter category name');
                return;
            }
            
            if (!restaurantData.settings.categories) {
                restaurantData.settings.categories = [];
            }
            
            if (restaurantData.settings.categories.includes(newCategory)) {
                alert('This category already exists');
                return;
            }
            
            restaurantData.settings.categories.push(newCategory);
            saveData();
            updateCategorySelects();
            loadCategoriesList();
            document.getElementById('new-category').value = '';
            alert('Category added successfully!');
        }

        function loadCategoriesList() {
            const categoriesList = document.getElementById('categories-list');
            categoriesList.innerHTML = '';
            
            const categories = restaurantData.settings.categories || [];
            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-item';
                categoryDiv.innerHTML = `
                    <span>${category}</span>
                    <button class="btn-danger btn-small" onclick="deleteCategory('${category}')">Delete</button>
                `;
                categoriesList.appendChild(categoryDiv);
            });
        }

        function deleteCategory(category) {
            if (confirm(`Delete category "${category}"? This will not delete menu items in this category.`)) {
                restaurantData.settings.categories = restaurantData.settings.categories.filter(cat => cat !== category);
                saveData();
                updateCategorySelects();
                loadCategoriesList();
                alert('Category deleted successfully!');
            }
        }

        // Bill functions
        function addToBill(item) {
            const existing = restaurantData.currentBill.items.find(i => i.id === item.id);
            if (existing) {
                existing.quantity += 1;
            } else {
                restaurantData.currentBill.items.push({
                    ...item,
                    quantity: 1
                });
            }
            updateOrderDisplay();
            saveData();
        }

        function changeQuantity(index, change) {
            const item = restaurantData.currentBill.items[index];
            item.quantity += change;
            if (item.quantity < 1) {
                restaurantData.currentBill.items.splice(index, 1);
            }
            updateOrderDisplay();
            saveData();
        }

        function removeItem(index) {
            restaurantData.currentBill.items.splice(index, 1);
            updateOrderDisplay();
            saveData();
        }

        function saveBill() {
            saveBillWithAction('saved');
        }

        function saveBillAndPrint() {
            saveBillWithAction('saved');
            setTimeout(printBill, 500);
        }

        function saveBillAndWhatsApp() {
            saveBillWithAction('saved');
            setTimeout(sendWhatsApp, 500);
        }

        function savePending() {
            saveBillWithAction('pending');
        }

        function saveBillWithAction(status) {
            const customerName = document.getElementById('customer-name').value.trim();
            const customerPhone = document.getElementById('customer-phone').value.trim();
            
            if (restaurantData.currentBill.items.length === 0) {
                alert('Please add at least one item to the bill');
                return;
            }

            const finalCustomerName = customerName || "Walk-in Customer";
            const finalCustomerPhone = customerPhone || "Not Provided";

            const bill = {
                id: Date.now(),
                number: restaurantData.currentBill.number,
                customer: {name: finalCustomerName, phone: finalCustomerPhone},
                orderType: document.getElementById('order-type').value,
                paymentMethod: document.getElementById('payment-method').value,
                items: [...restaurantData.currentBill.items],
                date: new Date().toLocaleString(),
                status: status,
                subtotal: restaurantData.currentBill.items.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                deliveryCharges: parseFloat(document.getElementById('delivery-charges').value) || 0,
                discountPercent: parseFloat(document.getElementById('discount-percent').value) || 0,
                taxPercent: parseFloat(document.getElementById('tax-percent').value) || 0
            };

            const discountAmount = bill.subtotal * (bill.discountPercent / 100);
            const taxAmount = (bill.subtotal - discountAmount) * (bill.taxPercent / 100);
            bill.total = bill.subtotal - discountAmount + taxAmount + bill.deliveryCharges;

            restaurantData.bills.push(bill);
            
            if (status === 'saved') {
                restaurantData.settings.billNumber++;
                restaurantData.currentBill.number = restaurantData.settings.billNumber;
            }

            restaurantData.currentBill.items = [];
            document.getElementById('customer-name').value = '';
            document.getElementById('customer-phone').value = '';
            document.getElementById('delivery-charges').value = '0';
            document.getElementById('discount-percent').value = '0';
            document.getElementById('tax-percent').value = '0';

            saveData();
            updateDisplay();
            alert(`Bill ${status === 'pending' ? 'saved as pending' : 'saved successfully'}!`);
        }

        function printBill() {
            const billContent = generateBillContent();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head><title>Bill Print</title></head>
                    <body style="font-family: Arial, sans-serif; padding: 20px;">
                        ${billContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function sendWhatsApp() {
            const customerPhone = document.getElementById('customer-phone').value.trim();
            if (!customerPhone) {
                alert('Please enter customer phone number for WhatsApp');
                return;
            }
            
            const billContent = generateBillContent().replace(/<[^>]*>/g, '');
            const message = encodeURIComponent(billContent);
            const whatsappUrl = `https://wa.me/${customerPhone}?text=${message}`;
            window.open(whatsappUrl, '_blank');
        }

        function generateBillContent() {
            const customerName = document.getElementById('customer-name').value.trim() || "Walk-in Customer";
            const customerPhone = document.getElementById('customer-phone').value.trim() || "Not Provided";
            
            const subtotal = restaurantData.currentBill.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryCharges = parseFloat(document.getElementById('delivery-charges').value) || 0;
            const discountPercent = parseFloat(document.getElementById('discount-percent').value) || 0;
            const taxPercent = parseFloat(document.getElementById('tax-percent').value) || 0;
            
            const discountAmount = subtotal * (discountPercent / 100);
            const taxAmount = (subtotal - discountAmount) * (taxPercent / 100);
            const total = subtotal - discountAmount + taxAmount + deliveryCharges;

            let content = `
                <h2>${restaurantData.settings.restaurantName}</h2>
                <p><strong>Bill #:</strong> ${restaurantData.currentBill.number}</p>
                <p><strong>Date:</strong> ${new Date().toLocaleString()}</p>
                <p><strong>Customer:</strong> ${customerName}</p>
                <p><strong>Phone:</strong> ${customerPhone}</p>
                <p><strong>Order Type:</strong> ${document.getElementById('order-type').value}</p>
                <hr>
                <table style="width:100%; border-collapse: collapse;">
                    <tr style="background: #f5f5f5;">
                        <th style="padding: 8px; border: 1px solid #ddd;">Item</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Price</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Qty</th>
                        <th style="padding: 8px; border: 1px solid #ddd;">Total</th>
                    </tr>
            `;
            
            restaurantData.currentBill.items.forEach(item => {
                content += `
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item.name}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Rs. ${item.price}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">${item.quantity} ${item.unit}</td>
                        <td style="padding: 8px; border: 1px solid #ddd;">Rs. ${item.price * item.quantity}</td>
                    </tr>
                `;
            });
            
            content += `
                </table>
                <hr>
                <p><strong>Subtotal:</strong> Rs. ${subtotal.toFixed(2)}</p>
                <p><strong>Discount (${discountPercent}%):</strong> Rs. ${discountAmount.toFixed(2)}</p>
                <p><strong>Tax (${taxPercent}%):</strong> Rs. ${taxAmount.toFixed(2)}</p>
                <p><strong>Delivery Charges:</strong> Rs. ${deliveryCharges.toFixed(2)}</p>
                <h3><strong>Total Amount: Rs. ${total.toFixed(2)}</strong></h3>
                <p><strong>Payment Method:</strong> ${document.getElementById('payment-method').value}</p>
                <hr>
                <p>Thank you for your business!</p>
            `;
            
            return content;
        }

        // Password Protection Functions
        function loginToReports() {
            const password = document.getElementById('reports-password').value;
            const storedPassword = restaurantData.settings.password || "zulqur";
            
            if (password === storedPassword) {
                isReportsLoggedIn = true;
                document.getElementById('reports-password-prompt').style.display = 'none';
                document.getElementById('reports-content').style.display = 'block';
                document.getElementById('reports-password').value = '';
                showDailyReports();
            } else {
                alert('Incorrect password!');
            }
        }

        function loginToSettings() {
            const password = document.getElementById('settings-password').value;
            const storedPassword = restaurantData.settings.password || "zulqur";
            
            if (password === storedPassword) {
                isSettingsLoggedIn = true;
                document.getElementById('settings-password-prompt').style.display = 'none';
                document.getElementById('settings-content').style.display = 'block';
                document.getElementById('settings-password').value = '';
                loadSettingsDisplay();
            } else {
                alert('Incorrect password!');
            }
        }

        // Settings Functions
        function loadSettingsDisplay() {
            document.getElementById('current-bill-no').textContent = restaurantData.settings.billNumber;
            loadMenuItemsList();
            loadCustomUnits();
            loadCategoriesList();
            document.getElementById('reset-frequency').value = restaurantData.settings.resetFrequency;
            
            document.getElementById('new-item-unit').addEventListener('change', function() {
                document.getElementById('custom-unit-input').style.display = 
                    this.value === 'custom' ? 'block' : 'none';
            });
        }

        function updateRestaurantName() {
            const newName = document.getElementById('restaurant-name-input').value;
            restaurantData.settings.restaurantName = newName;
            document.getElementById('restaurant-name').textContent = newName;
            saveData();
            alert('Restaurant name updated successfully!');
        }

        function addNewMenuItem() {
            const name = document.getElementById('new-item-name').value;
            const price = parseFloat(document.getElementById('new-item-price').value);
            const category = document.getElementById('new-item-category').value;
            let unit = document.getElementById('new-item-unit').value;
            
            if (unit === 'custom') {
                unit = document.getElementById('custom-unit-input').value;
                if (!unit) {
                    alert('Please enter custom unit name');
                    return;
                }
                if (!restaurantData.settings.customUnits.includes(unit)) {
                    restaurantData.settings.customUnits.push(unit);
                    loadCustomUnits();
                }
            }
            
            if (!name || !price || !category || !unit) {
                alert('Please fill all fields');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                name,
                price,
                category,
                unit
            };
            
            restaurantData.menuItems.push(newItem);
            saveData();
            updateCategoriesFilter();
            filterMenuItems();
            loadMenuItemsList();
            
            document.getElementById('new-item-name').value = '';
            document.getElementById('new-item-price').value = '';
            document.getElementById('new-item-category').value = '';
            document.getElementById('new-item-unit').value = 'plate';
            document.getElementById('custom-unit-input').style.display = 'none';
            document.getElementById('custom-unit-input').value = '';
            
            alert('Menu item added successfully!');
        }

        function loadMenuItemsList() {
            const menuList = document.getElementById('menu-items-list');
            menuList.innerHTML = '';
            
            restaurantData.menuItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'menu-item-row';
                itemDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>Rs. ${item.price} | ${item.category} | ${item.unit}</small>
                    </div>
                    <div class="action-btns">
                        <button class="btn btn-small" onclick="editMenuItem(${item.id})">Edit</button>
                        <button class="btn-danger btn-small" onclick="deleteMenuItem(${item.id})">Delete</button>
                    </div>
                `;
                menuList.appendChild(itemDiv);
            });
        }

        function editMenuItem(itemId) {
            const item = restaurantData.menuItems.find(i => i.id === itemId);
            if (item) {
                const newName = prompt('Enter new name:', item.name);
                if (newName) item.name = newName;
                
                const newPrice = prompt('Enter new price:', item.price);
                if (newPrice) item.price = parseFloat(newPrice);
                
                const newCategory = prompt('Enter new category:', item.category);
                if (newCategory) item.category = newCategory;
                
                const newUnit = prompt('Enter new unit:', item.unit);
                if (newUnit) item.unit = newUnit;
                
                saveData();
                updateCategoriesFilter();
                filterMenuItems();
                loadMenuItemsList();
                alert('Menu item updated successfully!');
            }
        }

        function deleteMenuItem(itemId) {
            if (confirm('Are you sure you want to delete this menu item?')) {
                restaurantData.menuItems = restaurantData.menuItems.filter(item => item.id !== itemId);
                saveData();
                updateCategoriesFilter();
                filterMenuItems();
                loadMenuItemsList();
                alert('Menu item deleted successfully!');
            }
        }

        function resetBillNumber() {
            if (confirm('Are you sure you want to reset bill number to 1?')) {
                restaurantData.settings.billNumber = 1;
                restaurantData.currentBill.number = 1;
                saveData();
                updateDisplay();
                loadSettingsDisplay();
                alert('Bill number reset to 1!');
            }
        }

        function addCustomUnit() {
            const newUnit = document.getElementById('new-custom-unit').value.trim();
            if (!newUnit) {
                alert('Please enter unit name');
                return;
            }
            
            if (restaurantData.settings.customUnits.includes(newUnit)) {
                alert('This unit already exists');
                return;
            }
            
            restaurantData.settings.customUnits.push(newUnit);
            saveData();
            loadCustomUnits();
            document.getElementById('new-custom-unit').value = '';
            alert('Custom unit added successfully!');
        }

        function loadCustomUnits() {
            const unitsList = document.getElementById('custom-units-list');
            unitsList.innerHTML = '';
            
            restaurantData.settings.customUnits.forEach(unit => {
                if (!['plate', 'kg', 'bowl', 'bottle'].includes(unit)) {
                    const unitDiv = document.createElement('div');
                    unitDiv.className = 'menu-item-row';
                    unitDiv.innerHTML = `
                        <div>${unit}</div>
                        <div>
                            <button class="btn-danger btn-small" onclick="deleteCustomUnit('${unit}')">Delete</button>
                        </div>
                    `;
                    unitsList.appendChild(unitDiv);
                }
            });
        }

        function deleteCustomUnit(unit) {
            if (confirm(`Delete unit "${unit}"?`)) {
                restaurantData.settings.customUnits = restaurantData.settings.customUnits.filter(u => u !== unit);
                saveData();
                loadCustomUnits();
                alert('Unit deleted successfully!');
            }
        }

        function changePassword() {
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!newPassword || !confirmPassword) {
                alert('Please fill both password fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            restaurantData.settings.password = newPassword;
            saveData();
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            alert('Password changed successfully!');
        }

        function exportData() {
            const dataStr = JSON.stringify(restaurantData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'restaurant_backup.json';
            link.click();
            URL.revokeObjectURL(url);
            alert('Data exported successfully!');
        }

        function importData() {
            document.getElementById('import-file').click();
        }

        function handleFileImport(files) {
            const file = files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    restaurantData = importedData;
                    saveData();
                    loadData();
                    alert('Data imported successfully!');
                } catch (error) {
                    alert('Error importing data. Invalid file format.');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('ARE YOU SURE? This will delete ALL data including bills, menu items, and settings!')) {
                localStorage.removeItem('restaurantData');
                restaurantData = {
                    bills: [],
                    menuItems: [
                        {id: 1, name: "Chicken Biryani", price: 300, category: "Biryani", unit: "plate"},
                        {id: 2, name: "Beef Biryani", price: 350, category: "Biryani", unit: "plate"},
                        {id: 3, name: "Chicken Karahi", price: 1200, category: "Karahi", unit: "kg"},
                        {id: 4, name: "Cold Drink", price: 60, category: "Beverages", unit: "bottle"}
                    ],
                    expenses: [],
                    settings: {
                        restaurantName: "Hafiz Chicken Tikka Biryani",
                        password: "zulqur",
                        billNumber: 1,
                        resetFrequency: "weekly",
                        customUnits: ["plate", "kg", "bowl", "bottle", "piece", "pack"],
                        categories: ["Biryani", "Karahi", "Beverages", "Rice", "BBQ", "Desserts"]
                    },
                    currentBill: {
                        number: 1,
                        items: [],
                        customer: {name: "", phone: ""},
                        orderType: "dine-in",
                        paymentMethod: "cash"
                    }
                };
                saveData();
                loadData();
                alert('All data cleared!');
            }
        }

        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionName === 'reports' && !isReportsLoggedIn) {
                document.getElementById('reports-password-prompt').style.display = 'block';
                document.getElementById('reports-content').style.display = 'none';
            } else if (sectionName === 'reports' && isReportsLoggedIn) {
                document.getElementById('reports-password-prompt').style.display = 'none';
                document.getElementById('reports-content').style.display = 'block';
                showDailyReports();
            }
            
            if (sectionName === 'settings' && !isSettingsLoggedIn) {
                document.getElementById('settings-password-prompt').style.display = 'block';
                document.getElementById('settings-content').style.display = 'none';
            } else if (sectionName === 'settings' && isSettingsLoggedIn) {
                document.getElementById('settings-password-prompt').style.display = 'none';
                document.getElementById('settings-content').style.display = 'block';
                loadSettingsDisplay();
            }
            
            if (sectionName === 'pending') loadPendingBills();
        }

        function loadPendingBills() {
            const pendingDiv = document.getElementById('pending-bills');
            const pendingBills = restaurantData.bills.filter(bill => bill.status === 'pending');
            
            if (pendingBills.length === 0) {
                pendingDiv.innerHTML = '<p>No pending bills</p>';
                return;
            }
            
            pendingDiv.innerHTML = '';
            pendingBills.forEach(bill => {
                const billCard = document.createElement('div');
                billCard.className = 'pending-bill-card';
                billCard.innerHTML = `
                    <h3>Bill #${bill.number} - ${bill.date.split(',')[0]}</h3>
                    <p><strong>Customer:</strong> ${bill.customer.name}</p>
                    <p><strong>Total:</strong> Rs. ${bill.total.toFixed(2)}</p>
                    <p><strong>Items:</strong> ${bill.items.length} items</p>
                    <button class="btn" onclick="editPendingBill(${bill.id})">Edit Bill</button>
                    <button class="btn-danger" onclick="deleteBill(${bill.id})">Delete</button>
                `;
                pendingDiv.appendChild(billCard);
            });
        }

        function editPendingBill(billId) {
            const bill = restaurantData.bills.find(b => b.id === billId);
            if (bill) {
                restaurantData.currentBill = {
                    number: bill.number,
                    items: bill.items,
                    customer: bill.customer,
                    orderType: bill.orderType,
                    paymentMethod: bill.paymentMethod
                };
                
                document.getElementById('customer-name').value = bill.customer.name;
                document.getElementById('customer-phone').value = bill.customer.phone;
                document.getElementById('order-type').value = bill.orderType;
                document.getElementById('payment-method').value = bill.paymentMethod;
                document.getElementById('delivery-charges').value = bill.deliveryCharges;
                document.getElementById('discount-percent').value = bill.discountPercent;
                document.getElementById('tax-percent').value = bill.taxPercent;
                
                restaurantData.bills = restaurantData.bills.filter(b => b.id !== billId);
                
                saveData();
                updateDisplay();
                showSection('billing');
                alert('Bill loaded for editing. Complete and save again.');
            }
        }

        function deleteBill(billId) {
            if (confirm('Delete this bill?')) {
                restaurantData.bills = restaurantData.bills.filter(b => b.id !== billId);
                saveData();
                loadPendingBills();
                alert('Bill deleted!');
            }
        }

        function showDailyReports() {
            const today = new Date().toDateString();
            const todayBills = restaurantData.bills.filter(bill => 
                new Date(bill.date).toDateString() === today && bill.status === 'saved'
            );
            
            displayReports(todayBills, 'Daily');
        }

        function showWeeklyReports() {
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const weeklyBills = restaurantData.bills.filter(bill => 
                new Date(bill.date) >= oneWeekAgo && bill.status === 'saved'
            );
            
            displayReports(weeklyBills, 'Weekly');
        }

        function showMonthlyReports() {
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const monthlyBills = restaurantData.bills.filter(bill => 
                new Date(bill.date) >= oneMonthAgo && bill.status === 'saved'
            );
            
            displayReports(monthlyBills, 'Monthly');
        }

        function displayReports(bills, period) {
            const totalSales = bills.reduce((sum, bill) => sum + bill.total, 0);
            const totalBills = bills.length;
            
            const cashSales = bills.filter(b => b.paymentMethod === 'cash').reduce((sum, b) => sum + b.total, 0);
            const jazzcashSales = bills.filter(b => b.paymentMethod === 'jazzcash').reduce((sum, b) => sum + b.total, 0);
            const easypaisaSales = bills.filter(b => b.paymentMethod === 'easypaisa').reduce((sum, b) => sum + b.total, 0);
            const foodpandaSales = bills.filter(b => b.paymentMethod === 'foodpanda').reduce((sum, b) => sum + b.total, 0);
            
            const dineInSales = bills.filter(b => b.orderType === 'dine-in').reduce((sum, b) => sum + b.total, 0);
            const takeAwaySales = bills.filter(b => b.orderType === 'take-away').reduce((sum, b) => sum + b.total, 0);
            const deliverySales = bills.filter(b => b.orderType === 'delivery').reduce((sum, b) => sum + b.total, 0);
            const foodPandaTypeSales = bills.filter(b => b.orderType === 'food-panda').reduce((sum, b) => sum + b.total, 0);
            
            const reportsHTML = `
                <div class="settings-section">
                    <h3>${period} Report</h3>
                    <p><strong>Total Bills:</strong> ${totalBills}</p>
                    <p><strong>Total Sales:</strong> Rs. ${totalSales.toFixed(2)}</p>
                </div>
                
                <div class="settings-section">
                    <h3>Sales by Payment Method</h3>
                    <p>Cash: Rs. ${cashSales.toFixed(2)}</p>
                    <p>JazzCash: Rs. ${jazzcashSales.toFixed(2)}</p>
                    <p>Easypaisa: Rs. ${easypaisaSales.toFixed(2)}</p>
                    <p>Food Panda: Rs. ${foodpandaSales.toFixed(2)}</p>
                </div>
                
                <div class="settings-section">
                    <h3>Sales by Order Type</h3>
                    <p>Dine In: Rs. ${dineInSales.toFixed(2)}</p>
                    <p>Take Away: Rs. ${takeAwaySales.toFixed(2)}</p>
                    <p>Delivery: Rs. ${deliverySales.toFixed(2)}</p>
                    <p>Food Panda: Rs. ${foodPandaTypeSales.toFixed(2)}</p>
                </div>
            `;
            
            document.getElementById('reports-data').innerHTML = reportsHTML;
        }

        function searchBill() {
            const billNo = parseInt(document.getElementById('search-bill-no').value);
            const bill = restaurantData.bills.find(b => b.number === billNo);
            displaySearchResults(bill ? [bill] : []);
        }

        function searchByDate() {
            const searchDate = document.getElementById('search-date').value;
            if (!searchDate) {
                alert('Please select a date');
                return;
            }
            
            const selectedDate = new Date(searchDate).toDateString();
            const bills = restaurantData.bills.filter(bill => 
                new Date(bill.date).toDateString() === selectedDate
            );
            
            displaySearchResults(bills);
        }

        function displaySearchResults(bills) {
            const resultsDiv = document.getElementById('search-results');
            
            if (bills.length === 0) {
                resultsDiv.innerHTML = '<p>No bills found</p>';
                return;
            }
            
            let resultsHTML = '';
            bills.forEach(bill => {
                resultsHTML += `
                    <div class="pending-bill-card">
                        <h3>Bill #${bill.number} - ${bill.date.split(',')[0]}</h3>
                        <p><strong>Customer:</strong> ${bill.customer.name} (${bill.customer.phone})</p>
                        <p><strong>Order Type:</strong> ${bill.orderType}</p>
                        <p><strong>Payment:</strong> ${bill.paymentMethod}</p>
                        <p><strong>Total:</strong> Rs. ${bill.total.toFixed(2)}</p>
                        <p><strong>Status:</strong> ${bill.status}</p>
                        <button class="btn" onclick="viewBillDetails(${bill.id})">View Details</button>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = resultsHTML;
        }

        function viewBillDetails(billId) {
            const bill = restaurantData.bills.find(b => b.id === billId);
            if (bill) {
                let detailsHTML = `
                    <div class="settings-section">
                        <h3>Bill #${bill.number} Details</h3>
                        <p><strong>Date:</strong> ${bill.date}</p>
                        <p><strong>Customer:</strong> ${bill.customer.name}</p>
                        <p><strong>Phone:</strong> ${bill.customer.phone}</p>
                        <p><strong>Order Type:</strong> ${bill.orderType}</p>
                        <p><strong>Payment Method:</strong> ${bill.paymentMethod}</p>
                        <hr>
                        <h4>Items:</h4>
                        <table>
                            <tr><th>Item</th><th>Price</th><th>Qty</th><th>Total</th></tr>
                `;
                
                bill.items.forEach(item => {
                    detailsHTML += `
                        <tr>
                            <td>${item.name}</td>
                            <td>Rs. ${item.price}</td>
                            <td>${item.quantity} ${item.unit}</td>
                            <td>Rs. ${item.price * item.quantity}</td>
                        </tr>
                    `;
                });
                
                detailsHTML += `
                        </table>
                        <hr>
                        <p><strong>Subtotal:</strong> Rs. ${bill.subtotal.toFixed(2)}</p>
                        <p><strong>Discount:</strong> ${bill.discountPercent}% (Rs. ${(bill.subtotal * bill.discountPercent / 100).toFixed(2)})</p>
                        <p><strong>Tax:</strong> ${bill.taxPercent}% (Rs. ${((bill.subtotal - (bill.subtotal * bill.discountPercent / 100)) * bill.taxPercent / 100).toFixed(2)})</p>
                        <p><strong>Delivery:</strong> Rs. ${bill.deliveryCharges.toFixed(2)}</p>
                        <h3><strong>Total: Rs. ${bill.total.toFixed(2)}</strong></h3>
                    </div>
                `;
                
                document.getElementById('search-results').innerHTML = detailsHTML;
            }
        }

        // Initialize app
        loadData();
    </script>
</body>
</html>
